<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank AMB System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; padding: 30px; }
        .panel { background: #f8f9fa; border-radius: 15px; padding: 25px; border: 2px solid #e9ecef; }
        .panel h2 { color: #667eea; margin-bottom: 20px; font-size: 1.5em; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #495057; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 1em; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #667eea; }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; width: 100%; transition: transform 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .result-card { background: white; border-left: 4px solid #667eea; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .result-card.warning { border-left-color: #ffc107; background: #fff3cd; }
        .result-card.danger { border-left-color: #dc3545; background: #f8d7da; }
        .result-card.charge-highlight { border: 3px solid #dc3545; background: linear-gradient(135deg, #ffe5e5 0%, #fff0f0 100%); box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3); }
        .result-card h3 { margin-bottom: 10px; color: #495057; font-size: 1.2em; }
        .result-card p { margin: 5px 0; color: #6c757d; }
        .charge-breakdown { background: white; padding: 15px; margin-top: 10px; border-radius: 8px; border: 2px solid #dee2e6; }
        .charge-breakdown h4 { color: #dc3545; margin-bottom: 10px; }
        .charge-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef; }
        .charge-row span:last-child { font-weight: 600; }
        .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 600; margin: 5px 5px 5px 0; }
        .badge.sms { background: #17a2b8; color: white; }
        .badge.no-sms { background: #6c757d; color: white; }
        .badge.charge { background: #dc3545; color: white; padding: 8px 15px; }
        .timeline { margin-top: 20px; }
        .timeline-item { display: flex; gap: 15px; margin-bottom: 20px; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: 20px; top: 40px; bottom: -20px; width: 2px; background: #dee2e6; }
        .timeline-item:last-child::before { display: none; }
        .timeline-marker { width: 40px; height: 40px; border-radius: 50%; background: #667eea; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0; z-index: 1; }
        .timeline-marker.charge-marker { background: #dc3545; width: 50px; height: 50px; font-size: 1.5em; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); } }
        .timeline-content { flex: 1; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .stat-card .number { font-size: 2.5em; font-weight: 700; color: #667eea; margin-bottom: 5px; }
        .stat-card.charge-stat .number { color: #dc3545; }
        .stat-card .label { color: #6c757d; font-size: 0.9em; }
        .scenarios { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .scenario-btn { background: white; border: 2px solid #667eea; color: #667eea; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 600; }
        .scenario-btn:hover { background: #667eea; color: white; transform: translateY(-2px); }
        .info-box { background: #e7f3ff; border-left: 4px solid #2196f3; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .info-box h4 { color: #1976d2; margin-bottom: 10px; }
        .info-box ul { margin-left: 20px; color: #555; }
        .info-box li { margin: 5px 0; }
        .deduction-notice { background: #fff3cd; border: 2px solid #ffc107; padding: 12px; border-radius: 8px; margin-top: 10px; font-weight: 600; color: #856404; text-align: center; }
        @media (max-width: 968px) { .main-content { grid-template-columns: 1fr; } .stats { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üè¶ Bank AMB Non-Maintenance Charge System</h1>
        <p>Average Monthly Balance Monitoring & Charge Calculator</p>
    </div>
    <div class="main-content">
        <div class="panel">
            <h2>üìä Account Configuration</h2>
            <div class="info-box">
                <h4>Business Rules:</h4>
                <ul>
                    <li>Minimum Balance: ‚Çπ10,000</li>
                    <li>Day 25: Check AMB (1-25), SMS if low</li>
                    <li>Day 3: Confirm defaults, charge if 2 consecutive months</li>
                    <li>Charge: min(6% √ó shortfall, ‚Çπ500) + 18% GST per month</li>
                </ul>
            </div>
            <div class="input-group">
                <label for="accountId">Account ID:</label>
                <input type="text" id="accountId" value="ACC001">
            </div>
            <div class="input-group">
                <label for="accountName">Account Holder Name:</label>
                <input type="text" id="accountName" value="John Doe">
            </div>
            <div class="input-group">
                <label for="balanceType">Balance Pattern:</label>
                <select id="balanceType">
                    <option value="constant">Constant Balance</option>
                    <option value="fluctuating">Fluctuating Balance</option>
                    <option value="custom">Custom Values</option>
                </select>
            </div>
            <div class="input-group" id="constantBalanceGroup">
                <label for="constantBalance">Balance Amount (‚Çπ):</label>
                <input type="number" id="constantBalance" value="500">
            </div>
            <div class="input-group" id="customBalanceGroup" style="display: none;">
                <label>Daily Balances (30 days, comma-separated):</label>
                <input type="text" id="customBalance" placeholder="500,600,700,...">
            </div>
            <div class="input-group">
                <label for="months">Number of Months to Simulate:</label>
                <input type="number" id="months" value="3" min="1" max="12">
            </div>
            <button class="btn" onclick="runSimulation()">‚ñ∂Ô∏è Run Simulation</button>
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">Quick Scenarios:</h3>
            <div class="scenarios">
                <button class="scenario-btn" onclick="loadScenario('happy')">üòä Happy Path</button>
                <button class="scenario-btn" onclick="loadScenario('single')">‚ö†Ô∏è Single Default</button>
                <button class="scenario-btn" onclick="loadScenario('chronic')">üî¥ Chronic Default</button>
                <button class="scenario-btn" onclick="loadScenario('recovery')">üíö Recovery</button>
            </div>
        </div>
        <div class="panel">
            <h2>üìà Simulation Results</h2>
            <div class="stats">
                <div class="stat-card"><div class="number" id="statMonths">0</div><div class="label">Months</div></div>
                <div class="stat-card"><div class="number" id="statDefaults">0</div><div class="label">Defaults</div></div>
                <div class="stat-card charge-stat"><div class="number" id="statCharges">0</div><div class="label">Charges</div></div>
                <div class="stat-card charge-stat"><div class="number" id="statTotal">‚Çπ0</div><div class="label">Total Charged</div></div>
            </div>
            <div class="results" id="results">
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <p>üëÜ Configure account and click "Run Simulation" to see results</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const MIN_BALANCE = 10000, CHARGE_RATE = 0.06, CHARGE_CAP = 500, GST_RATE = 0.18;
    document.getElementById('balanceType').addEventListener('change', function() {
        document.getElementById('constantBalanceGroup').style.display = this.value === 'custom' ? 'none' : 'block';
        document.getElementById('customBalanceGroup').style.display = this.value === 'custom' ? 'block' : 'none';
    });
    class Account {
        constructor(id, name, dailyBalances) { this.id = id; this.name = name; this.dailyBalances = dailyBalances; }
        calculateAMB(startDay, endDay) {
            let sum = 0;
            for (let i = startDay - 1; i < endDay && i < this.dailyBalances.length; i++) sum += this.dailyBalances[i];
            return (sum + ((30 - endDay) * 0)) / 30.0;
        }
    }
    class ProbableDefaulter { constructor(accountId, month, amb, smsSent) { this.accountId = accountId; this.month = month; this.amb = amb; this.smsSent = smsSent; } }
    class ActualDefaulter { constructor(accountId, month, amb, shortfall) { this.accountId = accountId; this.month = month; this.amb = amb; this.shortfall = shortfall; } }
    class Charge {
        constructor(accountId, month1, month2, shortfall1, shortfall2, chargedInMonth) {
            this.accountId = accountId; this.month1 = month1; this.month2 = month2; this.shortfall1 = shortfall1; this.shortfall2 = shortfall2; this.chargedInMonth = chargedInMonth;
            const baseCharge1 = Math.min(shortfall1 * CHARGE_RATE, CHARGE_CAP), gst1 = baseCharge1 * GST_RATE, total1 = baseCharge1 + gst1;
            const baseCharge2 = Math.min(shortfall2 * CHARGE_RATE, CHARGE_CAP), gst2 = baseCharge2 * GST_RATE, total2 = baseCharge2 + gst2;
            this.baseCharge1 = baseCharge1; this.gst1 = gst1; this.total1 = total1; this.baseCharge2 = baseCharge2; this.gst2 = gst2; this.total2 = total2;
            this.baseCharge = baseCharge1 + baseCharge2; this.gst = gst1 + gst2; this.total = total1 + total2;
        }
    }
    function evaluateRules(account, month, probableDefaulters, actualDefaulters, charges) {
        const results = { probableDefaulter: null, actualDefaulter: null, charge: null };
        const amb1_25 = account.calculateAMB(1, 25);
        if (amb1_25 < MIN_BALANCE) {
            const wasActualLastMonth = actualDefaulters.some(ad => ad.accountId === account.id && ad.month === month - 1);
            results.probableDefaulter = new ProbableDefaulter(account.id, month, amb1_25, !wasActualLastMonth);
        }
        const amb1_30 = account.calculateAMB(1, 30);
        const wasProbableLastMonth = probableDefaulters.some(pd => pd.accountId === account.id && pd.month === month);
        if (wasProbableLastMonth && amb1_30 < MIN_BALANCE) results.actualDefaulter = new ActualDefaulter(account.id, month, amb1_30, MIN_BALANCE - amb1_30);
        if (month >= 2) {
            const ad1 = actualDefaulters.find(ad => ad.accountId === account.id && ad.month === month - 1);
            const ad2 = actualDefaulters.find(ad => ad.accountId === account.id && ad.month === month);
            if (ad1 && ad2 && !charges.some(c => c.accountId === account.id && (c.month1 === month - 1 || c.month2 === month - 1 || c.month1 === month || c.month2 === month)))
                results.charge = new Charge(account.id, month - 1, month, ad1.shortfall, ad2.shortfall, month + 1);
        }
        return results;
    }
    function getMonthName(monthNum) { return ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][(monthNum - 1) % 12]; }
    function runSimulation() {
        const accountId = document.getElementById('accountId').value, accountName = document.getElementById('accountName').value;
        const balanceType = document.getElementById('balanceType').value, months = parseInt(document.getElementById('months').value);
        let dailyBalances;
        if (balanceType === 'custom') {
            dailyBalances = document.getElementById('customBalance').value.split(',').map(v => parseFloat(v.trim()));
            if (dailyBalances.length !== 30) { alert('Please enter exactly 30 daily balance values!'); return; }
        } else if (balanceType === 'constant') dailyBalances = Array(30).fill(parseFloat(document.getElementById('constantBalance').value));
        else { const base = parseFloat(document.getElementById('constantBalance').value); dailyBalances = Array(30).fill(0).map(() => base + (Math.random() - 0.5) * base * 0.3); }
        const probableDefaulters = [], actualDefaulters = [], charges = [], timeline = [];
        for (let month = 1; month <= months; month++) {
            const account = new Account(accountId, accountName, dailyBalances);
            const results25 = evaluateRules(account, month, probableDefaulters, actualDefaulters, charges);
            if (results25.probableDefaulter) { probableDefaulters.push(results25.probableDefaulter); timeline.push({ month, day: 25, type: 'probable', data: results25.probableDefaulter }); }
            const results3 = evaluateRules(account, month, probableDefaulters, actualDefaulters, charges);
            if (results3.actualDefaulter) { actualDefaulters.push(results3.actualDefaulter); timeline.push({ month: month + 1, day: 3, type: 'actual', data: results3.actualDefaulter }); }
            if (results3.charge) { charges.push(results3.charge); timeline.push({ month: month + 1, day: 3, type: 'charge', data: results3.charge }); }
        }
        displayResults(timeline, probableDefaulters, actualDefaulters, charges, months);
    }
    function displayResults(timeline, probableDefaulters, actualDefaulters, charges, months) {
        const totalCharged = charges.reduce((sum, c) => sum + c.total, 0);
        document.getElementById('statMonths').textContent = months;
        document.getElementById('statDefaults').textContent = actualDefaulters.length;
        document.getElementById('statCharges').textContent = charges.length;
        document.getElementById('statTotal').textContent = '‚Çπ' + totalCharged.toFixed(0);
        let html = '<div class="timeline">';
        if (timeline.length === 0) html = '<div style="text-align: center; padding: 40px; color: #28a745;"><h3>‚úÖ No Defaults!</h3><p>Account maintained minimum balance.</p></div>';
        else timeline.forEach(item => {
            const label = `${getMonthName(item.month)} (Month ${item.month}), Day ${item.day}`;
            if (item.type === 'probable') {
                const pd = item.data;
                html += `<div class="timeline-item"><div class="timeline-marker">${item.month}</div><div class="timeline-content"><div class="result-card warning"><h3>‚ö†Ô∏è Probable Defaulter</h3><p><strong>${label}</strong></p><p>AMB (Day 1-25): <strong>‚Çπ${pd.amb.toFixed(2)}</strong></p><p>Required: <strong>‚Çπ${MIN_BALANCE}</strong></p><p>Deficit: <strong>‚Çπ${(MIN_BALANCE - pd.amb).toFixed(2)}</strong></p><span class="badge ${pd.smsSent ? 'sms' : 'no-sms'}">${pd.smsSent ? '‚úâÔ∏è SMS Sent' : 'üì≠ No SMS'}</span></div></div></div>`;
            } else if (item.type === 'actual') {
                const ad = item.data;
                html += `<div class="timeline-item"><div class="timeline-marker">${item.month}</div><div class="timeline-content"><div class="result-card danger"><h3>üî¥ Actual Defaulter Confirmed</h3><p><strong>${label}</strong></p><p>Defaulted Month: <strong>${getMonthName(ad.month)} (${ad.month})</strong></p><p>Full Month AMB: <strong>‚Çπ${ad.amb.toFixed(2)}</strong></p><p>Shortfall: <strong>‚Çπ${ad.shortfall.toFixed(2)}</strong></p></div></div></div>`;
            } else if (item.type === 'charge') {
                const c = item.data;
                html += `<div class="timeline-item"><div class="timeline-marker charge-marker">üí∞</div><div class="timeline-content"><div class="result-card charge-highlight"><h3>üí∞ CHARGE DEDUCTED</h3><div class="deduction-notice">‚ö†Ô∏è Deducted on: <strong>${getMonthName(c.chargedInMonth)} ${c.chargedInMonth}, Day 3</strong></div><p style="margin-top:15px;"><strong>For Months: ${getMonthName(c.month1)} (${c.month1}) & ${getMonthName(c.month2)} (${c.month2})</strong></p><div class="charge-breakdown"><h4>üìä ${getMonthName(c.month1)} (${c.month1})</h4><div class="charge-row"><span>Shortfall:</span><span>‚Çπ${c.shortfall1.toFixed(2)}</span></div><div class="charge-row"><span>Base (6%):</span><span>‚Çπ${c.baseCharge1.toFixed(2)}</span></div><div class="charge-row"><span>GST (18%):</span><span>‚Çπ${c.gst1.toFixed(2)}</span></div><div class="charge-row"><span>Total:</span><span>‚Çπ${c.total1.toFixed(2)}</span></div></div><div class="charge-breakdown"><h4>üìä ${getMonthName(c.month2)} (${c.month2})</h4><div class="charge-row"><span>Shortfall:</span><span>‚Çπ${c.shortfall2.toFixed(2)}</span></div><div class="charge-row"><span>Base (6%):</span><span>‚Çπ${c.baseCharge2.toFixed(2)}</span></div><div class="charge-row"><span>GST (18%):</span><span>‚Çπ${c.gst2.toFixed(2)}</span></div><div class="charge-row"><span>Total:</span><span>‚Çπ${c.total2.toFixed(2)}</span></div></div><div class="charge-breakdown" style="background:#ffe5e5;border-color:#dc3545;"><div class="charge-row" style="border:none;font-size:1.3em;padding:15px 0;"><span>üí≥ TOTAL DEDUCTED:</span><span style="color:#dc3545;">‚Çπ${c.total.toFixed(2)}</span></div></div><span class="badge charge">‚ö° Debited ${getMonthName(c.chargedInMonth)} ${c.chargedInMonth}</span></div></div></div>`;
            }
        });
        html += '</div>';
        if (charges.length > 0) {
            html += `<div class="result-card danger" style="margin-top:20px;"><h3>üìä Final Summary</h3><p>Probable Defaulters: <strong>${probableDefaulters.length}</strong></p><p>Actual Defaulters: <strong>${actualDefaulters.length}</strong></p><p>Charges Applied: <strong>${charges.length}</strong></p><div style="margin-top:15px;padding-top:15px;border-top:2px solid #dc3545;"><p style="font-size:1.1em;font-weight:700;">Charge Details:</p>`;
            charges.forEach((c, idx) => { html += `<div style="margin:10px 0;padding:10px;background:white;border-radius:5px;"><p><strong>Charge ${idx + 1}:</strong> ‚Çπ${c.total.toFixed(2)}</p><p style="font-size:0.9em;color:#6c757d;">‚Ä¢ Months: ${getMonthName(c.month1)} (${c.month1}) + ${getMonthName(c.month2)} (${c.month2})<br>‚Ä¢ Deducted: ${getMonthName(c.chargedInMonth)} ${c.chargedInMonth}</p></div>`; });
            html += `</div><div style="margin-top:20px;padding:20px;background:#dc3545;color:white;border-radius:10px;text-align:center;"><p style="font-size:1.5em;font-weight:700;margin:0;">üí∞ TOTAL CHARGED: ‚Çπ${totalCharged.toFixed(2)}</p></div></div>`;
        } else if (actualDefaulters.length > 0) html += `<div class="result-card warning" style="margin-top:20px;"><h3>‚ÑπÔ∏è Note</h3><p>There are ${actualDefaulters.length} actual defaulter(s), but no charges yet.</p><p><strong>Reason:</strong> Charges require 2 consecutive months of defaults.</p></div>`;
        document.getElementById('results').innerHTML = html;
    }
    function loadScenario(type) {
        const m = document.getElementById('months'), b = document.getElementById('constantBalance'), t = document.getElementById('balanceType');
        t.value = 'constant'; t.dispatchEvent(new Event('change'));
        if (type === 'happy') { b.value = 15000; m.value = 4; }
        else if (type === 'single') { b.value = 500; m.value = 1; }
        else if (type === 'chronic') { b.value = 500; m.value = 6; }
        else if (type === 'recovery') { b.value = 500; m.value = 3; }
    }
    window.onload = () => setTimeout(() => { loadScenario('chronic'); runSimulation(); }, 500);
</script>
</body>
</html>